<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Imaigine Leonardo prompt toolkit</title>
  <script>
    const sharedSettings = {
      sd_version: 'v1_5',
      num_images: 1,
      num_inference_steps: 30, // between 30 and 60
      guidance_scale: 7, // Must be between 1 and 20.
      scheduler: 'EULER_DISCRETE',
      tiling: false,
      public: false,
      init_strength: 0.5,
      controlNet: false,
    }

    const promptTemplates = {
      character: {
        ...sharedSettings,
        modelId: 'a097c2df-8f0c-4029-ae0f-8fd349055e61', // Rpg4.0
        width: 640,
        height: 832,
        presetStyle: 'NONE',
        negative_prompt: 'two heads, two faces, poorly drawn hands, missing limbs, blurred, floating limbs, disconnected limbs, misshapen hands, blurry, out of focus, two different eyes, strange eyes, unclear eyes, watermarks, text, long neck',
        prompt: "detailed illustration of %, a portrait, fantasy, rpg, medieval. lush illumination, concept art, Greg Rutkowski, Artgerm, WLOP, Alphonse Mucha, line-art illustration, face on golden ratio",

      },
      location: {
        ...sharedSettings,
        modelId: 'a097c2df-8f0c-4029-ae0f-8fd349055e61', // Rpg4.0
        width: 768,
        height: 768,
        presetStyle: 'LEONARDO',
        prompt: "detailed illustration of %, a place, fantasy, rpg, medieval. concept art, trending on artstation, lush illumination, high contrast, vibrant, Greg Rutkowski, Artgerm, WLOP, line-art illustration",

      },
      item: {
        ...sharedSettings,
        modelId: "2d18c0af-374e-4391-9ca2-639f59837c85", // Magic Items
        width: 512,
        height: 512,
        presetStyle: 'LEONARDO',
        promptMagic: true,
        negative_prompt: 'overlapping, fading, multiple items, cluttered background, person, animal, alive, eyes',
        prompt: "ultra-detailed illustration of a %, an item, lush illumination, high contrast, front view, digital painting, game art, game item",


      }
    }

    async function executePrompt() {
      var modeRadios = document.getElementsByName('prompt_type');
      var mode;
      for (var i = 0; i < modeRadios.length; i++) {
        if (modeRadios[i].checked) {
          mode = modeRadios[i].value;
          break;
        }
      }
      console.log(mode)
      document.getElementById("image").src = ""

      let prompt = document.getElementById("prompt").value
      prompt = promptTemplates[mode].prompt.replace("%", prompt)

      const params = promptTemplates[mode]


      console.log({
        ...params,
        prompt,
      })
      const generationId = (await (await fetch("https://cloud.leonardo.ai/api/rest/v1/generations", {
        method: 'POST',
        headers: {
          accept: 'application/json',
          'content-type': 'application/json',
          authorization: 'Bearer a50655aa-f0be-4146-9d91-cc21b662ff80'
        },
        body: JSON.stringify({
          ...params,
          prompt,
        })
      })).json()).sdGenerationJob.generationId


      let images = []
      let result
      while (images.length === 0) {

        result = (await (await fetch(`https://cloud.leonardo.ai/api/rest/v1/generations/${generationId}`, {
          method: 'GET',
          headers: {
            accept: 'application/json',
            'content-type': 'application/json',
            authorization: 'Bearer a50655aa-f0be-4146-9d91-cc21b662ff80'
          }

        })).json()).generations_by_pk

        images = result.generated_images


        await new Promise(r => setTimeout(r, 2000));
      }

      document.getElementById("image").src = images[0].url
      document.getElementById("apicall").innerText = JSON.stringify(result, null, "\t")
    }
  </script>
</head>

<body>
<style>
  body {
    font-size: 16px;
  }

  label {
    margin-right: 20px;
  }

  input {
    padding: 15px 40px;
  }

  body {
    background-color: #333333;
    color: aliceblue;
    font-family: 'Segoe UI', Arial;
  }
</style>
<input checked id="character" name="prompt_type" type="radio" value="character">
<label for="character">Character</label>

<input id="location" name="prompt_type" type="radio" value="location">
<label for="location">Location</label>

<input id="item" name="prompt_type" type="radio" value="item">
<label for="item">Item</label>

<br />
<br>
<label for="prompt">Prompt</label>
<br /><input id="prompt" placeholder="great elf with blue eyes and sharp teeth" type="text" />
<input onclick="executePrompt()" type="button" value="execute" />


<hr />
<img id="image" src="" />
<div id="apicall"></div>
</body>

</html>
